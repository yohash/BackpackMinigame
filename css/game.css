/* Backpack Minigame Styles - Direct Viewport Approach */
/* Systematically override Twine's layout constraints */

/* =============================================== */
/* DIRECT TWINE STRUCTURE OVERRIDE */
/* =============================================== */


/* Story Stylesheet — simple local serif stack, Georgia first */
.passage,
#ui-bar, #ui-dialog, #ui-overlay, #story {
  font-family: Georgia, "Iowan Old Style", "Palatino Linotype", Palatino,
               "Book Antiqua", serif !important;
}

/* Any passage tagged [splash] gets full-bleed layout */
.passage.splash {
  margin: 0 !important;
  padding: 0 !important;
}

#passage-Start #title-root { min-height: 100vh; }
@supports (height: 100svh) {
  #passage-Start #title-root { min-height: 100svh; }
}

/* Remove SugarCube’s default padding/margins ONLY on StartScreen */
body.passage-StartScreen #passages { padding: 0 !important; }
body.passage-StartScreen .passage  { margin: 0 !important; padding: 0 !important; }
body.passage-StartScreen .passage > :first-child { margin-top: 0 !important; }


/* Full-viewport centering for the title canvas */
#title-root {
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
}

/* Canvas that scales with browser height */
#title-canvas {
  position: relative;
  background-image: url("images/title_screen.jpg"); 
  background-repeat: no-repeat;
  background-position: center top;
  background-size: auto 100%; 

  height: 100vh;
  width: 100%;
  max-width: none;
}

/* Mobile viewport height (prevents iOS URL bar issues) */
@supports (height: 100svh) {
  #title-canvas {
    height: 100svh;
  }
}

/* Use small-viewport-height if supported (mobile address bar safe) */
@supports (height: 100svh) {
  #title-canvas {
    height: 100svh;
    width: 100svh;
  }
}

/* The floating black box in the top quarter of the image */
#start-panel {
 position: absolute;
  top: 2.5rem;                 
  left: 50%;
  transform: translateX(-50%);
  margin: 0;                 
  padding: 0.6rem 0.8rem;
  width: min(60%, 600px);
  text-align: center;
  background: rgba(0,0,0,0.88);
  color: #fff;
  border-radius: 14px;
  box-shadow: 0 10px 10px rgba(0,0,0,0.25);
  box-sizing: border-box;    
}

/* Link styling inside the panel */
#start-panel a {
  color: #fff;
  text-decoration: none;
  border-bottom: 1px solid rgba(255,255,255,0.25);
}
#start-panel a:hover {
  border-bottom-color: rgba(255,255,255,0.85);
}

/* Byline */
#start-panel .byline {
  display: block;
  opacity: 0.85;
  font-size: 1rem;
}




/* Target ALL Twine layout containers and make them full-width when game is present */
body:has(#backpack-game-container),
body.backpack-active {
    margin: 0 !important;
    padding: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    overflow-x: hidden !important;
}

/* Force Twine's main containers to full viewport width */
body:has(#backpack-game-container) #passages,
body:has(#backpack-game-container) #story,
body.backpack-active #passages,
body.backpack-active #story {
    max-width: none !important;
    width: 100vw !important;
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
}

/* Force the specific passage containing the game to full width */
body:has(#backpack-game-container) .passage,
body.backpack-active .passage,
.passage:has(#backpack-game-container),
.passage.backpack-passage {
    max-width: none !important;
    width: 100vw !important;
    margin: 0 !important;
    padding: 0 !important;
    box-sizing: border-box !important;
    position: relative !important;
    left: 0 !important;
    right: 0 !important;
}

/* Hide Twine UI when game is active */
body:has(#backpack-game-container) #ui-bar,
body.backpack-active #ui-bar {
    display: none !important;
}

/* =============================================== */
/* GAME CONTAINER - Simple Viewport Fill */
/* =============================================== */

/* Game Container - completely breaks out of document flow */
#backpack-game-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 80px;
    background: black;
    box-sizing: border-box;
    z-index: 9999;
    /* Center the game content */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

/* Canvas Container - maintains 16:9 ratio, fits in available space */
.canvas-wrapper {
    position: relative;
    /* Calculate maximum size that fits viewport while maintaining aspect ratio */
    width: min(calc(100vw - 40px), calc((100vh - 120px) * 16/9));
    height: min(calc(100vh - 120px), calc((100vw - 40px) * 9/16));
    display: block;
    box-sizing: border-box;
}

/* Canvas - fills wrapper completely */
#backpack-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /*border: 4px solid #4a5568;
    border-radius: 8px;*/
    background: black;
    cursor: grab;
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
    box-sizing: border-box;
}

#backpack-canvas.dragging {
    cursor: grabbing;
}

/* =============================================== */
/* UI ELEMENTS - Positioned Relative to Viewport */
/* =============================================== */

#object-counter {
    position: absolute;
    top: 40px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.95);
    padding: 10px 20px;
    border-radius: 20px;
    font-weight: 600;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    color: #4a5568;
    z-index: 10;
    pointer-events: none;
}

#placed-count {
    color: #48bb78;
    font-weight: bold;
    font-size: 1.2em;
}

#total-count {
    font-weight: bold;
    font-size: 1.2em;
    color: #4a5568;
}

/* Control Buttons */
#reset-btn,
#done-btn {
    position: absolute;
    padding: 12px 24px;
    font-size: 16px;
    font-weight: 600;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    z-index: 100;
    pointer-events: auto;
}

#reset-btn {
    top: 40px;
    left: 40px;
    background: #e2e8f0;
    color: #4a5568;
}

#reset-btn:hover {
    background: #cbd5e0;
    transform: translateY(-1px);
}

#done-btn {
    top: 40px;
    right: 40px;
    background: linear-gradient(135deg, #68d391 0%, #48bb78 100%);
    color: white;
    box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
}

#done-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(72, 187, 120, 0.5);
}

#done-btn:disabled {
    background: #cbd5e0;
    cursor: not-allowed;
    box-shadow: none;
}

/* =============================================== */
/* RESPONSIVE BREAKPOINTS */
/* =============================================== */

/* Large screens - optimize for desktop */
@media (min-width: 1200px) {
    .canvas-wrapper {
        width: min(calc(100vw - 80px), calc((100vh - 160px) * 16/9));
        height: min(calc(100vh - 160px), calc((100vw - 80px) * 9/16));
    }
    
    #backpack-game-container {
        padding: 40px;
    }
}

/* Medium screens - tablets landscape */
@media (max-width: 1199px) and (min-width: 768px) {
    .canvas-wrapper {
        width: min(calc(100vw - 40px), calc((100vh - 120px) * 16/9));
        height: min(calc(100vh - 120px), calc((100vw - 40px) * 9/16));
    }
    
    #backpack-game-container {
        padding: 20px;
    }
    
    #reset-btn,
    #done-btn {
        padding: 10px 20px;
        font-size: 14px;
    }
    
    #object-counter {
        font-size: 0.95em;
        padding: 8px 16px;
    }
}

/* Small screens - tablets portrait and large phones */
@media (max-width: 767px) and (min-width: 480px) {
    .canvas-wrapper {
        width: min(calc(100vw - 30px), calc((100vh - 100px) * 16/9));
        height: min(calc(100vh - 100px), calc((100vw - 30px) * 9/16));
    }
    
    #backpack-game-container {
        padding: 15px;
    }
    
    #reset-btn,
    #done-btn {
        padding: 8px 16px;
        font-size: 13px;
        top: 30px;
    }
    
    #reset-btn {
        left: 30px;
    }
    
    #done-btn {
        right: 30px;
    }
    
    #object-counter {
        font-size: 0.9em;
        padding: 6px 12px;
        top: 30px;
    }
}

/* Mobile phones */
@media (max-width: 479px) {
    .canvas-wrapper {
        width: min(calc(100vw - 20px), calc((100vh - 80px) * 16/9));
        height: min(calc(100vh - 80px), calc((100vw - 20px) * 9/16));
    }
    
    #backpack-game-container {
        padding: 10px;
    }
    
    #reset-btn,
    #done-btn {
        padding: 6px 12px;
        font-size: 11px;
        top: 20px;
    }
    
    #reset-btn {
        left: 20px;
    }
    
    #done-btn {
        right: 20px;
    }
    
    #object-counter {
        font-size: 0.8em;
        padding: 4px 10px;
        top: 20px;
    }
}

/* =============================================== */
/* BROWSER COMPATIBILITY FALLBACKS */
/* =============================================== */

/* For browsers without :has() support - requires manual class addition */
@supports not selector(:has(*)) {
    /* Apply the same overrides using .backpack-active class */
    body.backpack-active {
        margin: 0 !important;
        padding: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        overflow-x: hidden !important;
    }
    
    body.backpack-active #passages,
    body.backpack-active #story {
        max-width: none !important;
        width: 100vw !important;
        margin: 0 !important;
        padding: 0 !important;
        box-sizing: border-box !important;
    }
    
    body.backpack-active .passage,
    .passage.backpack-active {
        max-width: none !important;
        width: 100vw !important;
        margin: 0 !important;
        padding: 0 !important;
        box-sizing: border-box !important;
        position: relative !important;
        left: 0 !important;
        right: 0 !important;
    }
    
    body.backpack-active #ui-bar {
        display: none !important;
    }
}

/* =============================================== */
/* LOADING STATE */
/* =============================================== */

#backpack-game-container.loading {
    opacity: 0.5;
    pointer-events: none;
}

#backpack-game-container.loading::after {
    content: "Loading...";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 24px;
    color: #4a5568;
    font-weight: 600;
}